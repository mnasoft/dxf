;;;; header-section-group-codes-list.lisp

(in-package #:dxf)

(defparameter *h-vars-list-min*
  '(("ACADVER"  1 "AC1027")
    ("HANDSEED" 5 97))
  "Мининмальный файл заголовка")

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defparameter *h-vars-list*
  '(("ACADVER"               1           "AC1027")
    ("ACADMAINTVER"         70   20)
    ("DWGCODEPAGE"           3   "ANSI_1251")
    ("LASTSAVEDBY"           1   "namatv")
    ("REQUIREDVERSIONS"    160   0)
    ("INSBASE"              10   #(0.0 0.0 0.0))
    ("EXTMIN"               10   #(1.E+20 1.E+20 1.E+20))
    ("EXTMAX"               10   #(-1.E+20 -1.E+20 -1.E+20))
    ("LIMMIN"               10   #(0.0 0.0))
    ("LIMMAX"               10   #(420.0 297.0))
    ("ORTHOMODE"            70   0)
    ("REGENMODE"            70   1)
    ("FILLMODE"             70   1)
    ("QTEXTMODE"            70   0)
    ("MIRRTEXT"             70   0)
    ("LTSCALE"              40   1.0)
    ("ATTMODE"              70   1)
    ("TEXTSIZE"             40   2.5)
    ("TRACEWID"             40   1.0)
    ("TEXTSTYLE"             7   "Standard")
    ("CLAYER"                8   "0")
    ("CELTYPE"               6   "ByLayer")
    ("CECOLOR"              62   256)
    ("CELTSCALE"            40   1.0)
    ("DISPSILH"             70   0)
    ("DIMSCALE"             40   1.0)
    ("DIMASZ"               40   2.5)
    ("DIMEXO"               40   0.625)
    ("DIMDLI"               40   3.75)
    ("DIMRND"               40   0.0)
    ("DIMDLE"               40   0.0)
    ("DIMEXE"               40   1.25)
    ("DIMTP"                40   0.0)
    ("DIMTM"                40   0.0)
    ("DIMTXT"               40   2.5)
    ("DIMCEN"               40   2.5)
    ("DIMTSZ"               40   0.0)
    ("DIMTOL"               70   0)
    ("DIMLIM"               70   0)
    ("DIMTIH"               70   0)
    ("DIMTOH"               70   0)
    ("DIMSE1"               70   0)
    ("DIMSE2"               70   0)
    ("DIMTAD"               70   1)
    ("DIMZIN"               70   8)
    ("DIMBLK"                1   "")
    ("DIMASO"               70   1)
    ("DIMSHO"               70   1)
    ("DIMPOST"               1   "")
    ("DIMAPOST"              1   "")
    ("DIMALT"               70   0)
    ("DIMALTD"              70   3)
    ("DIMALTF"              40   0.03937007874016)
    ("DIMLFAC"              40   1.0)
    ("DIMTOFL"              70   1)
    ("DIMTVP"               40   0.0)
    ("DIMTIX"               70   0)
    ("DIMSOXD"              70   0)
    ("DIMSAH"               70   0)
    ("DIMBLK1"               1   "")
    ("DIMBLK2"               1   "")
    ("DIMSTYLE"              2   "ISO-25")
    ("DIMCLRD"              70   0)
    ("DIMCLRE"              70   0)
    ("DIMCLRT"              70   0)
    ("DIMTFAC"              40   1.0)
    ("DIMGAP"               40   0.625)
    ("DIMJUST"              70   0)
    ("DIMSD1"               70   0)
    ("DIMSD2"               70   0)
    ("DIMTOLJ"              70   0)
    ("DIMTZIN"              70   8)
    ("DIMALTZ"              70   0)
    ("DIMALTTZ"             70   0)
    ("DIMUPT"               70   0)
    ("DIMDEC"               70   2)
    ("DIMTDEC"              70   2)
    ("DIMALTU"              70   2)
    ("DIMALTTD"             70   3)
    ("DIMTXSTY"              7   "Standard")
    ("DIMAUNIT"             70   0)
    ("DIMADEC"              70   0)
    ("DIMALTRND"            40   0.0)
    ("DIMAZIN"              70   0)
    ("DIMDSEP"              70   44)
    ("DIMATFIT"             70   3)
    ("DIMFRAC"              70   0)
    ("DIMLDRBLK"             1   "")
    ("DIMLUNIT"             70   2)
    ("DIMLWD"               70   -2)
    ("DIMLWE"               70   -2)
    ("DIMTMOVE"             70   0)
    ("DIMFXL"               40   1.0)
    ("DIMFXLON"             70   0)
    ("DIMJOGANG"            40   0.7853981633974483)
    ("DIMTFILL"             70   0)
    ("DIMTFILLCLR"          70   0)
    ("DIMARCSYM"            70   0)
    ("DIMLTYPE"              6   "")
    ("DIMLTEX1"              6   "")
    ("DIMLTEX2"              6   "")
    ("DIMTXTDIRECTION"      70   0)
    ("LUNITS"               70   2)
    ("LUPREC"               70   4)
    ("SKETCHINC"            40   1.0)
    ("FILLETRAD"            40   0.0)
    ("AUNITS"               70   0)
    ("AUPREC"               70   0)
    ("MENU"                  1   ".")
    ("ELEVATION"            40   0.0)
    ("PELEVATION"           40   0.0)
    ("THICKNESS"            40   0.0)
    ("LIMCHECK"             70   0)
    ("CHAMFERA"             40   0.0)
    ("CHAMFERB"             40   0.0)
    ("CHAMFERC"             40   0.0)
    ("CHAMFERD"             40   0.0)
    ("SKPOLY"               70   0)
    ("TDCREATE"             40   2457804.467045579)
    ("TDUCREATE"            40   2457804.383712245)
    ("TDUPDATE"             40   2457804.467436215)
    ("TDUUPDATE"            40   2457804.384102882)
    ("TDINDWG"              40   0.0003909491)
    ("TDUSRTIMER"           40   0.0003908681)
    ("USRTIMER"             70   1)
    ("ANGBASE"              50   0.0)
    ("ANGDIR"               70   0)
    ("PDMODE"               70   0)
    ("PDSIZE"               40   0.0)
    ("PLINEWID"             40   0.0)
    ("SPLFRAME"             70   0)
    ("SPLINETYPE"           70   6)
    ("SPLINESEGS"           70   8)
    ("HANDSEED"              5   560) 
    ("SURFTAB1"             70   6)
    ("SURFTAB2"             70   6)
    ("SURFTYPE"             70   6)
    ("SURFU"                70   6)
    ("SURFV"                70   6)
    ("UCSBASE"               2   "")
    ("UCSNAME"               2   "")
    ("UCSORG"               10   #(0.0 0.0 0.0))
    ("UCSXDIR"              10   #(1.0 0.0 0.0))
    ("UCSYDIR"              10   #(0.0 1.0 0.0))
    ("UCSORTHOREF"           2   "")
    ("UCSORTHOVIEW"         70   0)
    ("UCSORGTOP"            10   #(0.0 0.0 0.0))
    ("UCSORGBOTTOM"         10   #(0.0 0.0 0.0))
    ("UCSORGLEFT"           10   #(0.0 0.0 0.0))
    ("UCSORGRIGHT"          10   #(0.0 0.0 0.0))
    ("UCSORGFRONT"          10   #(0.0 0.0 0.0))
    ("UCSORGBACK"           10   #(0.0 0.0 0.0))
    ("PUCSBASE"              2   "")
    ("PUCSNAME"              2   "")
    ("PUCSORG"              10   #(0.0 0.0 0.0))
    ("PUCSXDIR"             10   #(1.0 0.0 0.0))
    ("PUCSYDIR"             10   #(0.0 1.0 0.0))
    ("PUCSORTHOREF"          2   "")
    ("PUCSORTHOVIEW"        70   0)
    ("PUCSORGTOP"           10   #(0.0 0.0 0.0))
    ("PUCSORGBOTTOM"        10   #(0.0 0.0 0.0))
    ("PUCSORGLEFT"          10   #(0.0 0.0 0.0))
    ("PUCSORGRIGHT"         10   #(0.0 0.0 0.0))
    ("PUCSORGFRONT"         10   #(0.0 0.0 0.0))
    ("PUCSORGBACK"          10   #(0.0 0.0 0.0))
    ("USERI1"               70   0)
    ("USERI2"               70   0)
    ("USERI3"               70   0)
    ("USERI4"               70   0)
    ("USERI5"               70   0)
    ("USERR1"               40   0.0)
    ("USERR2"               40   0.0)
    ("USERR3"               40   0.0)
    ("USERR4"               40   0.0)
    ("USERR5"               40   0.0)
    ("WORLDVIEW"            70   1)
    ("SHADEDGE"             70   3)
    ("SHADEDIF"             70   70)
    ("TILEMODE"             70   1)
    ("MAXACTVP"             70   64)
    ("PINSBASE"             10   #(0.0 0.0 0.0))
    ("PLIMCHECK"            70   0)
    ("PEXTMIN"              10   #(0.0 0.0 0.0))
    ("PEXTMAX"              10   #(0.0 0.0 0.0))
    ("PLIMMIN"              10   #(0.0 0.0))
    ("PLIMMAX"              10   #(12.0 9.0))
    ("UNITMODE"             70   0)
    ("VISRETAIN"            70   1)
    ("PLINEGEN"             70   0)
    ("PSLTSCALE"            70   1)
    ("TREEDEPTH"            70   3020)
    ("CMLSTYLE"              2   "Standard")
    ("CMLJUST"              70   0)
    ("CMLSCALE"             40   20.0)
    ("PROXYGRAPHICS"        70   1)
    ("MEASUREMENT"          70   1)
    ("CELWEIGHT"           370   -1)
    ("ENDCAPS"             280   0)
    ("JOINSTYLE"           280   0)
    ("LWDISPLAY"           290   0)
    ("INSUNITS"             70   4)
    ("HYPERLINKBASE"         1   "")
    ("STYLESHEET"            1   "")
    ("XEDIT"               290   1)
    ("CEPSNTYPE"           380   0)
    ("PSTYLEMODE"          290   1)
    ("FINGERPRINTGUID"       2   "{A066C69A-91DF-4F34-A204-AF3BEC30AA17}")
    ("VERSIONGUID"           2   "{02B655AA-2030-4262-89BC-BE4F196822EC}")
    ("EXTNAMES"            290   1)
    ("PSVPSCALE"            40   0.0)
    ("OLESTARTUP"          290   0)
    ("SORTENTS"            280   127)
    ("INDEXCTL"            280   0)
    ("HIDETEXT"            280   1)
    ("XCLIPFRAME"          280   2)
    ("HALOGAP"             280   0)
    ("OBSCOLOR"             70   257)
    ("OBSLTYPE"            280   0)
    ("INTERSECTIONDISPLAY" 280   0)
    ("INTERSECTIONCOLOR"    70   257)
    ("DIMASSOC"            280   2)
    ("PROJECTNAME"           1   "")
    ("CAMERADISPLAY"       290   0)
    ("LENSLENGTH"           40   50.0)
    ("CAMERAHEIGHT"         40   0.0)
    ("STEPSPERSEC"          40   2.0)
    ("STEPSIZE"             40   6.0)
    ("3DDWFPREC"            40   2.0)
    ("PSOLWIDTH"            40   5.0)
    ("PSOLHEIGHT"           40   80.0)
    ("LOFTANG1"             40   1.570796326794896)
    ("LOFTANG2"             40   1.570796326794896)
    ("LOFTMAG1"             40   0.0)
    ("LOFTMAG2"             40   0.0)
    ("LOFTPARAM"            70   7)
    ("LOFTNORMALS"         280   1)
    ("LATITUDE"             40   37.795)
    ("LONGITUDE"            40   -122.394)
    ("NORTHDIRECTION"       40   0.0)
    ("TIMEZONE"             70   -8000)
    ("LIGHTGLYPHDISPLAY"   280   1)
    ("TILEMODELIGHTSYNCH"  280   1)
    ("CMATERIAL"           347   236) 
    ("SOLIDHIST"           280   0)
    ("SHOWHIST"            280   1)
    ("DWFFRAME"            280   2)
    ("DGNFRAME"            280   0)
    ("REALWORLDSCALE"      290   1)
    ("INTERFERECOLOR"       62   1)
    ("INTERFEREOBJVS"      345   249)
    ("INTERFEREVPVS"       346   246)
    ("CSHADOW"             280   0)
    ("SHADOWPLANELOCATION"  40   0.0)))

(defparameter *h-vars* (make-hash-table :test 'equal))

(mapc #'(lambda (el) (setf (gethash (first el) *h-vars*) (list (second el) (third el)))) *h-vars-list*)


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defclass db-header ()
  ((header-vars :accessor header-vars :initarg :header-vars :initform *h-vars-list*
		:documentation "
http://help.autodesk.com/view/ACD/2017/RUS/?guid=GUID-A85E8E67-27CD-4C59-BE61-4DC9FADBE74A
http://help.autodesk.com/view/ACD/2017/ENU/?guid=GUID-A85E8E67-27CD-4C59-BE61-4DC9FADBE74A
")))

(defmethod dxf-out-text :before ((x Db-Header) stream)
  (dxf-out-t-string 0 *section* stream)
  (dxf-out-t-string 2 *section-header* stream))

(defmethod dxf-out-text ((x Db-Header) stream)
  (mapc #'(lambda (el)
	    (when (third el)
	      (dxf-out-t-string 9 (concatenate 'string "$" (first el)) stream)
	      (dxf-out-t (second el) (third el) stream)))
	(header-vars x)))

(defmethod dxf-out-text :after ((x Db-Header) stream)
    (dxf-out-t-string 0 *endsec* stream))

(defparameter *hdr* (make-instance 'db-header))

(dxf-out-text *hdr* t)




